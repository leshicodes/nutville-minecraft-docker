version: '3.8'

services:
  minecraft:
    image: itzg/minecraft-server:${MC_CONTAINER_VERS}
    container_name: ${MC_SERVER_HOSTNAME}
    hostname: ${MC_SERVER_HOSTNAME}
    ports:
      - "${MC_SERVER_PORT}:25565"
      # - 8888:8888
    volumes:
      - ./mc:/data
    env_file:
      - .env
      - .env.secrets
    restart: always
  minecraft-backup:
    image: itzg/mc-backup
    container_name: minecraft-backup-sidecar
    hostname: minecraft-backup-sidecar
    depends_on:
      minecraft:
        condition: service_healthy
    env_file:
      - .env
      - .env.secrets
    environment:
      RCON_HOST: ${MC_SERVER_HOSTNAME}
      PRE_BACKUP_SCRIPT: |
        echo "Beginning MC Server backup"
        rcon-cli --host minecraft say "Beginning MC Server backup ; You may experience lag."
    volumes:
      - ./mc:/data:ro
      - ./mc-backups:/backups
  bluemap:
    image: ghcr.io/bluemap-minecraft/bluemap:latest
    container_name: bluemap
    hostname: bluemap
    ports:
      - "8100:8100"
    volumes:
      # - ./mc/plugins/BlueMap:/app/config
      - ./bluemap/config:/app/config
      - ./bluemap/data:/app/data
      - ./mc/world:/app/world:ro
      - ./bluemap/web:/app/web
    command: -r -u -w
    networks:
      default:
      mediaserver_network:
        aliases:
          - bluemap

  newt:
    image: fosrl/newt
    container_name: newt
    restart: unless-stopped
    env_file:
      - .env.secrets
    environment:
      - PANGOLIN_ENDPOINT=https://proxy.leshicodes.info
      - NEWT_ID=waomqt0lfc9rbk8
      - ACCEPT_CLIENTS=true
    networks:
      default:
      mediaserver_network:
        aliases:
          - newt-mc


networks:
  default:
  mediaserver_network:
    external: true